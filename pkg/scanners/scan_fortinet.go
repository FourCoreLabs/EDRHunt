package scanners

import "github.com/FourCoreLabs/EDRHunt/pkg/resources"

type FortinetDetection struct{}

func (w *FortinetDetection) Name() string {
	return "Fortinet"
}

func (w *FortinetDetection) Type() resources.EDRType {
	return resources.FortinetEDR
}

var FortinetHeuristic = []string{
	"Fortinet",
	"dcagent.dll",
	"dcagent_amd64.dll",
	"FSAEConfig.exe",
	"uninstalldcagent.exe",
	"fortilspheuristics.dll",
	"mdare.dll",
	"fccomintdll.dll",
	"fcoeam.dll",
	"fwutil.dll",
	"fccomint.exe",
	"fclanguageselector.exe",
	"fortifw.exe",
	"fcreg.exe",
	"fortitray.exe",
	"libcfg.dll",
	"fcappdb.exe",
	"fcoehook.dll",
	"fcwizard.exe",
	"fcp.dll",
	"fcresc.dll",
	"submitv.exe",
	"av_task.exe",
	"fortiwf.exe",
	"forticlish.dll",
	"fortiece.dll",
	"libavr.dll",
	"fortiwadbd.exe",
	"utilsdll.dll",
	"fase.dll",
	"fcauth.exe",
	"fcdblog.exe",
	"fcmgr.exe",
	"fortiwad.exe",
	"libav.dll",
	"fortiproxy.exe",
	"fortiskin.dll",
	"fortiscand.exe",
	"fortivpnst.dll",
	"fortivpnst.exe",
	"fortivpnst64.dll",
	"ipsec.exe",
	"fasle.dll",
	"fcwscd7.exe",
	"fcasc.exe",
	"fchelper.exe",
	"forticlient.exe",
	"fcwsc.exe",
	"forticlish.dll",
	"FortiClient Service Scheduler",
	"FortiClient.exe",
	"av_task.exe",
	"fortiwad.exe",
	"fortiproxy.exe",
	"fcmgr.exe",
	"FortiLSPHeuristics.dll",
	"mdare.dll",
	"npccpluginex.dll",
	"nptcplugin.dll",
	"npccplugin.dll",
	"FCCOMIntDLL.dll",
	"FCOEAM.dll",
	"FSSOMA.exe",
	"LaunchCacheClean.dll",
	"launchcacheclean64.dll",
	"rmon.exe",
	"FCCOMInt.exe",
	"FCVbltScan.exe",
	"sslvpnhostcheck.dll",
	"sslvpnhostcheck64.dll",
	"FortiESNAC.exe",
	"FortiTray.exe",
	"fcappdb.exe",
	"FCConfig.exe",
	"FCOEHook.dll",
	"fcp.dll",
	"FCResc.dll",
	"forticachecleaner.dll",
	"FortiCacheCleaner64.dll",
	"forticredentialprovider.dll",
	"FortiCredentialProvider2x64.dll",
	"forticredentialprovider64.dll",
	"FortiTrayResc.dll",
	"av_task.exe",
	"FortiWF.exe",
	"EPCUserAvatar.exe",
	"FortiAvatar.exe",
	"FortiCliSh.dll",
	"FortiCliSh64.dll",
	"libavr.dll",
	"fortifws.exe",
	"FortiWadbd.exe",
	"FortiClient_Diagnostic_Tool.exe",
	"forticontrol.dll",
	"FortiSSLVPNdaemon.exe",
	"utilsdll.dll",
	"FCAuth.exe",
	"FortiCliSh.dll",
	"FortiCliSh64.dll",
	"npccpluginex.dll",
	"nptcplugin.dll",
	"npccplugin.dll",
	"FortiClient Service Scheduler",
	"av_task.exe",
	"FortiESNAC.exe",
	"ipsec.exe",
	"FortiWad.exe",
	"FortiProxy.exe",
}

func (w *FortinetDetection) Detect(data resources.SystemData) (resources.EDRType, bool) {
	_, ok := data.CountMatchesAll(FortinetHeuristic)
	if !ok {
		return "", false
	}

	return resources.FortinetEDR, true
}
